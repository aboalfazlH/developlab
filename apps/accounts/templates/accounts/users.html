{% extends "base/base.html" %}
{% load static %}
{% load follow_tags %}

{% block title %}
  {% if has_following %}
    دنبال شوندگان {{ profile }}
  {% elif has_followers %}
    دنبال کنندگان {{ profile }}
  {% else %}
    کاربران
  {% endif %}
{% endblock title %}

{% block content %}
<div class="container py-4">

  <h2 class="mb-4">
    کاربران
    {% if has_following %}
      دنبال شونده توسط {{ profile }}
    {% elif has_followers %}
      دنبال کننده {{ profile }}
    {% endif %}
  </h2>

  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">

    {% for profile_user in page_obj.object_list %}
    <div class="col">
      <div
        class="card h-100"
        onclick="window.location='{{ profile_user.get_absolute_url }}'"
      >

        <div class="text-center mt-3">
          {% if profile_user.avatar %}
            <img
              src="{{ profile_user.avatar.url }}"
              class="rounded-circle"
              style="width: 80px; height: 80px"
              alt="{{ profile_user.username }}"
            />
          {% else %}
            <img
              src="{% static 'default_avatar.png' %}"
              class="rounded-circle"
              style="width: 80px; height: 80px"
              alt="Default Avatar"
            />
          {% endif %}
        </div>

        <div class="card-body text-center">

          <h5 class="card-title">
            {{ profile_user.get_full_name|default:profile_user.username }}
          </h5>

          {% if profile_user.about %}
            <p class="card-text">
              {{ profile_user.about|truncatechars:100 }}
            </p>
          {% endif %}

          {% if request.user.is_authenticated and request.user != profile_user %}
          <form
            action="{% url 'user-follow' profile_user.username %}"
            method="post"
            onclick="event.stopPropagation()"
          >
            {% csrf_token %}

            {% if request.user|is_following:profile_user %}
              <button class="btn btn-danger btn-sm" type="submit">
                لغو دنبال
              </button>
            {% else %}
              <button class="btn btn-primary btn-sm" type="submit">
                دنبال کردن
              </button>
            {% endif %}
          </form>
          {% endif %}

          <div class="d-flex justify-content-center flex-wrap gap-1 mt-2">
            {% if profile_user.git_account %}
              <a href="{{ profile_user.git_account }}" target="_blank"
                 class="btn btn-outline-dark btn-sm">Git</a>
            {% endif %}

            {% if profile_user.website %}
              <a href="{{ profile_user.website }}" target="_blank"
                 class="btn btn-outline-primary btn-sm">Website</a>
            {% endif %}

            {% if profile_user.instagram %}
              <a href="{{ profile_user.instagram }}" target="_blank"
                 class="btn btn-outline-danger btn-sm">Instagram</a>
            {% endif %}
          </div>

        </div>
      </div>
    </div>
    {% empty %}
      <p class="text-center">هیچ کاربری یافت نشد.</p>
    {% endfor %}

  </div>

  {% include "components/pagination.html" %}

</div>
{% endblock content %}
